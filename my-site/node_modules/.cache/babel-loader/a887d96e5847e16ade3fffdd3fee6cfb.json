{"remainingRequest":"E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\node_modules\\thread-loader\\dist\\cjs.js!E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\node_modules\\babel-loader\\lib\\index.js!E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\src\\views\\Message\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\src\\views\\Message\\index.vue","mtime":1619069503738},{"path":"E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkU6L1ZVRTJcdTVCNjZcdTRFNjAvXHU2NDJEXHU1RUZBXHU1REU1XHU3QTBCL1x1NEUyQVx1NEVCQVx1NTM1QVx1NUJBMlx1OTg3OVx1NzZFRS9teS1zaXRlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiOwovLwovLwovLwovLwovLwovLwovLwovLwppbXBvcnQgTWVzc2FnZUFyZWEgZnJvbSAiQC9jb21wb25lbnRzL01lc3NhZ2VBcmVhIjsKaW1wb3J0IGZldGNoRGF0YSBmcm9tICJAL21peGlucy9mZXRjaERhdGEuanMiOwppbXBvcnQgKiBhcyBtc2dBcGkgZnJvbSAiQC9hcGkvbWVzc2FnZS5qcyI7CmltcG9ydCBtYWluU2Nyb2xsIGZyb20gIkAvbWl4aW5zL21haW5TY3JvbGwuanMiOwpleHBvcnQgZGVmYXVsdCB7CiAgbWl4aW5zOiBbZmV0Y2hEYXRhKHsKICAgIHRvdGFsOiAwLAogICAgcm93czogW10KICB9KSwgbWFpblNjcm9sbCgibWVzc2FnZUNvbnRhaW5lciIpXSwKICBjb21wb25lbnRzOiB7CiAgICBNZXNzYWdlQXJlYTogTWVzc2FnZUFyZWEKICB9LAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBwYWdlOiAxLAogICAgICBsaW1pdDogMTAKICAgIH07CiAgfSwKICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkgewogICAgdGhpcy4kYnVzLiRvbigibWFpblNjcm9sbCIsIHRoaXMuaGFuZGxlU2Nyb2xsKTsKICB9LAogIGRlc3Ryb3llZDogZnVuY3Rpb24gZGVzdHJveWVkKCkgewogICAgdGhpcy4kYnVzLiRvZmYoIm1haW5TY3JvbGwiLCB0aGlzLmhhbmRsZVNjcm9sbCk7CiAgfSwKICBjb21wdXRlZDogewogICAgaGFzTW9zZTogZnVuY3Rpb24gaGFzTW9zZSgpIHsKICAgICAgcmV0dXJuIHRoaXMuZGF0YS5yb3dzLmxlbmd0aCA8IHRoaXMuZGF0YS50b3RhbDsKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGZldGNoRGF0YTogZnVuY3Rpb24gZmV0Y2hEYXRhKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiBtc2dBcGkuZ2VuTWVzc2FnZShfdGhpcy5wYWdlLCBfdGhpcy5saW1pdCk7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIF9jb250ZXh0LnNlbnQpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlKTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgaGFuZGxlU2Nyb2xsOiBmdW5jdGlvbiBoYW5kbGVTY3JvbGwoZG9tKSB7CiAgICAgIC8vY29uc29sZS5sb2coZG9tKQogICAgICBpZiAodGhpcy5pc0xvYWRpbmcgfHwgIWRvbSkgewogICAgICAgIC8v5Y+v5Yqg6L295pu05aSaCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgcmFuZ2UgPSAxMDA7IC8v5a6a5LiA5Liq5Y+v5o6l5Y+X55qE6IyD5Zu077yM5Zyo6L+Z5Liq6IyD5Zu05YaF6YO9566X6L6+5Yiw5LqG5bqV6YOoCgogICAgICB2YXIgZGVjID0gTWF0aC5hYnMoZG9tLnNjcm9sbFRvcCArIGRvbS5jbGllbnRIZWlnaHQgLSBkb20uc2Nyb2xsSGVpZ2h0KTsKCiAgICAgIGlmIChkZWMgPD0gcmFuZ2UpIHsKICAgICAgICB0aGlzLmZldGNoTW9yZSgpOwogICAgICB9CiAgICB9LAogICAgLy/liqDovb3kuIvkuIDpobUKICAgIGZldGNoTW9yZTogZnVuY3Rpb24gZmV0Y2hNb3JlKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgIHZhciByZXNwOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBpZiAoX3RoaXMyLmhhc01vc2UpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAyOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIF90aGlzMi5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgX3RoaXMyLnBhZ2UrKzsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNjsKICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczIuZmV0Y2hEYXRhKCk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIHJlc3AgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgIF90aGlzMi5kYXRhLnRvdGFsID0gcmVzcC50b3RhbDsKICAgICAgICAgICAgICAgIF90aGlzMi5kYXRhLnJvd3MgPSBfdGhpczIuZGF0YS5yb3dzLmNvbmNhdChyZXNwLnJvd3MpOwogICAgICAgICAgICAgICAgX3RoaXMyLmlzTG9hZGluZyA9IGZhbHNlOwoKICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyKTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgaGFuZGxlU3VibWl0OiBmdW5jdGlvbiBoYW5kbGVTdWJtaXQoZGF0YSwgY2FsbGJhY2spIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMygpIHsKICAgICAgICB2YXIgcmVzcDsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAyOwogICAgICAgICAgICAgICAgcmV0dXJuIG1zZ0FwaS5wb3N0TWVzc2FnZShkYXRhKTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgcmVzcCA9IF9jb250ZXh0My5zZW50OwoKICAgICAgICAgICAgICAgIF90aGlzMy5kYXRhLnJvd3MudW5zaGlmdChyZXNwKTsKCiAgICAgICAgICAgICAgICBjYWxsYmFjaygi5oSf6LCi5oKo55qE55WZ6KiAIik7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMyk7CiAgICAgIH0pKSgpOwogICAgfQogIH0KfTs="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;AASA,OAAA,WAAA,MAAA,0BAAA;AACA,OAAA,SAAA,MAAA,uBAAA;AACA,OAAA,KAAA,MAAA,MAAA,kBAAA;AACA,OAAA,UAAA,MAAA,wBAAA;AAEA,eAAA;AACA,EAAA,MAAA,EAAA,CAAA,SAAA,CAAA;AAAA,IAAA,KAAA,EAAA,CAAA;AAAA,IAAA,IAAA,EAAA;AAAA,GAAA,CAAA,EAAA,UAAA,CAAA,kBAAA,CAAA,CADA;AAEA,EAAA,UAAA,EAAA;AACA,IAAA,WAAA,EAAA;AADA,GAFA;AAKA,EAAA,IALA,kBAKA;AACA,WAAA;AACA,MAAA,IAAA,EAAA,CADA;AAEA,MAAA,KAAA,EAAA;AAFA,KAAA;AAIA,GAVA;AAWA,EAAA,OAXA,qBAWA;AACA,SAAA,IAAA,CAAA,GAAA,CAAA,YAAA,EAAA,KAAA,YAAA;AACA,GAbA;AAcA,EAAA,SAdA,uBAcA;AACA,SAAA,IAAA,CAAA,IAAA,CAAA,YAAA,EAAA,KAAA,YAAA;AACA,GAhBA;AAiBA,EAAA,QAAA,EAAA;AACA,IAAA,OADA,qBACA;AACA,aAAA,KAAA,IAAA,CAAA,IAAA,CAAA,MAAA,GAAA,KAAA,IAAA,CAAA,KAAA;AACA;AAHA,GAjBA;AAsBA,EAAA,OAAA,EAAA;AACA,IAAA,SADA,uBACA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACA,MAAA,CAAA,UAAA,CAAA,KAAA,CAAA,IAAA,EAAA,KAAA,CAAA,KAAA,CADA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,KAHA;AAIA,IAAA,YAJA,wBAIA,GAJA,EAIA;AACA;AACA,UAAA,KAAA,SAAA,IAAA,CAAA,GAAA,EAAA;AACA;AACA;AACA;;AACA,UAAA,KAAA,GAAA,GAAA,CANA,CAMA;;AACA,UAAA,GAAA,GAAA,IAAA,CAAA,GAAA,CAAA,GAAA,CAAA,SAAA,GAAA,GAAA,CAAA,YAAA,GAAA,GAAA,CAAA,YAAA,CAAA;;AACA,UAAA,GAAA,IAAA,KAAA,EAAA;AACA,aAAA,SAAA;AACA;AAEA,KAhBA;AAiBA;AACA,IAAA,SAlBA,uBAkBA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACA,MAAA,CAAA,OADA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAKA,gBAAA,MAAA,CAAA,SAAA,GAAA,IAAA;AACA,gBAAA,MAAA,CAAA,IAAA;AANA;AAAA,uBAOA,MAAA,CAAA,SAAA,EAPA;;AAAA;AAOA,gBAAA,IAPA;AAQA,gBAAA,MAAA,CAAA,IAAA,CAAA,KAAA,GAAA,IAAA,CAAA,KAAA;AACA,gBAAA,MAAA,CAAA,IAAA,CAAA,IAAA,GAAA,MAAA,CAAA,IAAA,CAAA,IAAA,CAAA,MAAA,CAAA,IAAA,CAAA,IAAA,CAAA;AACA,gBAAA,MAAA,CAAA,SAAA,GAAA,KAAA;;AAVA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWA,KA7BA;AA8BA,IAAA,YA9BA,wBA8BA,IA9BA,EA8BA,QA9BA,EA8BA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACA,MAAA,CAAA,WAAA,CAAA,IAAA,CADA;;AAAA;AACA,gBAAA,IADA;;AAEA,gBAAA,MAAA,CAAA,IAAA,CAAA,IAAA,CAAA,OAAA,CAAA,IAAA;;AACA,gBAAA,QAAA,CAAA,QAAA,CAAA;;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAlCA;AAtBA,CAAA","sourcesContent":["<template>\r\n<div class=\"message-container\" ref=\"messageContainer\">\r\n <MessageArea title=\"留言板\" :subTitle=\"`(${data.total})`\" \r\n :isListLoading=\"isLoading\" :list=\"data.rows\" @submit=\"handleSubmit\" />\r\n</div>\r\n \r\n</template>\r\n\r\n<script>\r\nimport MessageArea from \"@/components/MessageArea\";\r\nimport fetchData from \"@/mixins/fetchData.js\";\r\nimport * as msgApi from \"@/api/message.js\";\r\nimport mainScroll from \"@/mixins/mainScroll.js\";\r\n\r\nexport default {\r\n  mixins:[fetchData( {total: 0, rows: [] } ), mainScroll(\"messageContainer\")],\r\n      components:{\r\n        MessageArea,\r\n      },\r\n      data(){\r\n            return {\r\n              page:1 ,\r\n              limit: 10\r\n            }\r\n      },\r\n      created(){\r\n        this.$bus.$on(\"mainScroll\",this.handleScroll);\r\n      },\r\n      destroyed(){\r\n        this.$bus.$off(\"mainScroll\", this.handleScroll);\r\n      },\r\n      computed:{\r\n              hasMose(){\r\n                return this.data.rows.length < this.data.total;\r\n              }\r\n      },\r\n      methods:{\r\n        async fetchData(){\r\n          return await msgApi.genMessage(this.page, this.limit);\r\n        },\r\n        handleScroll(dom){\r\n          //console.log(dom)\r\n          if(this.isLoading || !dom){\r\n            //可加载更多\r\n            return;\r\n          }\r\n          const range = 100;//定一个可接受的范围，在这个范围内都算达到了底部\r\n          const dec = Math.abs(dom.scrollTop + dom.clientHeight - dom.scrollHeight);\r\n          if(dec <= range){\r\n            this.fetchMore();\r\n          }\r\n        \r\n        },\r\n        //加载下一页\r\n        async fetchMore(){\r\n            if(!this.hasMose){\r\n              //没有更多了\r\n              return\r\n            }\r\n            this.isLoading = true;\r\n            this.page++;\r\n            const resp = await this.fetchData();\r\n            this.data.total = resp.total;\r\n            this.data.rows = this.data.rows.concat(resp.rows);\r\n            this.isLoading = false;\r\n        },\r\n        async handleSubmit(data, callback){\r\n          const resp = await msgApi.postMessage(data);\r\n              this.data.rows.unshift(resp);\r\n              callback(\"感谢您的留言\");\r\n        }\r\n      }\r\n}\r\n</script>\r\n\r\n<style >\r\n.message-container{\r\n  width: 100%;\r\n  height: 100%;\r\n  position: relative;\r\n  overflow-y: auto;\r\n  box-sizing: border-box;\r\n}\r\n.message-area-container{\r\n  width: 700px;\r\n  padding: 25px 0;\r\n  margin: 0 auto;\r\n}\r\n</style>"],"sourceRoot":"src/views/Message"}]}