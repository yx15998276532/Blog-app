{"remainingRequest":"E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\src\\views\\Message\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\src\\views\\Message\\index.vue","mtime":1619069503738},{"path":"E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgTWVzc2FnZUFyZWEgZnJvbSAiQC9jb21wb25lbnRzL01lc3NhZ2VBcmVhIjsNCmltcG9ydCBmZXRjaERhdGEgZnJvbSAiQC9taXhpbnMvZmV0Y2hEYXRhLmpzIjsNCmltcG9ydCAqIGFzIG1zZ0FwaSBmcm9tICJAL2FwaS9tZXNzYWdlLmpzIjsNCmltcG9ydCBtYWluU2Nyb2xsIGZyb20gIkAvbWl4aW5zL21haW5TY3JvbGwuanMiOw0KDQpleHBvcnQgZGVmYXVsdCB7DQogIG1peGluczpbZmV0Y2hEYXRhKCB7dG90YWw6IDAsIHJvd3M6IFtdIH0gKSwgbWFpblNjcm9sbCgibWVzc2FnZUNvbnRhaW5lciIpXSwNCiAgICAgIGNvbXBvbmVudHM6ew0KICAgICAgICBNZXNzYWdlQXJlYSwNCiAgICAgIH0sDQogICAgICBkYXRhKCl7DQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICBwYWdlOjEgLA0KICAgICAgICAgICAgICBsaW1pdDogMTANCiAgICAgICAgICAgIH0NCiAgICAgIH0sDQogICAgICBjcmVhdGVkKCl7DQogICAgICAgIHRoaXMuJGJ1cy4kb24oIm1haW5TY3JvbGwiLHRoaXMuaGFuZGxlU2Nyb2xsKTsNCiAgICAgIH0sDQogICAgICBkZXN0cm95ZWQoKXsNCiAgICAgICAgdGhpcy4kYnVzLiRvZmYoIm1haW5TY3JvbGwiLCB0aGlzLmhhbmRsZVNjcm9sbCk7DQogICAgICB9LA0KICAgICAgY29tcHV0ZWQ6ew0KICAgICAgICAgICAgICBoYXNNb3NlKCl7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGF0YS5yb3dzLmxlbmd0aCA8IHRoaXMuZGF0YS50b3RhbDsNCiAgICAgICAgICAgICAgfQ0KICAgICAgfSwNCiAgICAgIG1ldGhvZHM6ew0KICAgICAgICBhc3luYyBmZXRjaERhdGEoKXsNCiAgICAgICAgICByZXR1cm4gYXdhaXQgbXNnQXBpLmdlbk1lc3NhZ2UodGhpcy5wYWdlLCB0aGlzLmxpbWl0KTsNCiAgICAgICAgfSwNCiAgICAgICAgaGFuZGxlU2Nyb2xsKGRvbSl7DQogICAgICAgICAgLy9jb25zb2xlLmxvZyhkb20pDQogICAgICAgICAgaWYodGhpcy5pc0xvYWRpbmcgfHwgIWRvbSl7DQogICAgICAgICAgICAvL+WPr+WKoOi9veabtOWkmg0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgIH0NCiAgICAgICAgICBjb25zdCByYW5nZSA9IDEwMDsvL+WumuS4gOS4quWPr+aOpeWPl+eahOiMg+WbtO+8jOWcqOi/meS4quiMg+WbtOWGhemDveeul+i+vuWIsOS6huW6lemDqA0KICAgICAgICAgIGNvbnN0IGRlYyA9IE1hdGguYWJzKGRvbS5zY3JvbGxUb3AgKyBkb20uY2xpZW50SGVpZ2h0IC0gZG9tLnNjcm9sbEhlaWdodCk7DQogICAgICAgICAgaWYoZGVjIDw9IHJhbmdlKXsNCiAgICAgICAgICAgIHRoaXMuZmV0Y2hNb3JlKCk7DQogICAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgfSwNCiAgICAgICAgLy/liqDovb3kuIvkuIDpobUNCiAgICAgICAgYXN5bmMgZmV0Y2hNb3JlKCl7DQogICAgICAgICAgICBpZighdGhpcy5oYXNNb3NlKXsNCiAgICAgICAgICAgICAgLy/msqHmnInmm7TlpJrkuoYNCiAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7DQogICAgICAgICAgICB0aGlzLnBhZ2UrKzsNCiAgICAgICAgICAgIGNvbnN0IHJlc3AgPSBhd2FpdCB0aGlzLmZldGNoRGF0YSgpOw0KICAgICAgICAgICAgdGhpcy5kYXRhLnRvdGFsID0gcmVzcC50b3RhbDsNCiAgICAgICAgICAgIHRoaXMuZGF0YS5yb3dzID0gdGhpcy5kYXRhLnJvd3MuY29uY2F0KHJlc3Aucm93cyk7DQogICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOw0KICAgICAgICB9LA0KICAgICAgICBhc3luYyBoYW5kbGVTdWJtaXQoZGF0YSwgY2FsbGJhY2spew0KICAgICAgICAgIGNvbnN0IHJlc3AgPSBhd2FpdCBtc2dBcGkucG9zdE1lc3NhZ2UoZGF0YSk7DQogICAgICAgICAgICAgIHRoaXMuZGF0YS5yb3dzLnVuc2hpZnQocmVzcCk7DQogICAgICAgICAgICAgIGNhbGxiYWNrKCLmhJ/osKLmgqjnmoTnlZnoqIAiKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KfQ0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;AASA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/Message","sourcesContent":["<template>\r\n<div class=\"message-container\" ref=\"messageContainer\">\r\n <MessageArea title=\"留言板\" :subTitle=\"`(${data.total})`\" \r\n :isListLoading=\"isLoading\" :list=\"data.rows\" @submit=\"handleSubmit\" />\r\n</div>\r\n \r\n</template>\r\n\r\n<script>\r\nimport MessageArea from \"@/components/MessageArea\";\r\nimport fetchData from \"@/mixins/fetchData.js\";\r\nimport * as msgApi from \"@/api/message.js\";\r\nimport mainScroll from \"@/mixins/mainScroll.js\";\r\n\r\nexport default {\r\n  mixins:[fetchData( {total: 0, rows: [] } ), mainScroll(\"messageContainer\")],\r\n      components:{\r\n        MessageArea,\r\n      },\r\n      data(){\r\n            return {\r\n              page:1 ,\r\n              limit: 10\r\n            }\r\n      },\r\n      created(){\r\n        this.$bus.$on(\"mainScroll\",this.handleScroll);\r\n      },\r\n      destroyed(){\r\n        this.$bus.$off(\"mainScroll\", this.handleScroll);\r\n      },\r\n      computed:{\r\n              hasMose(){\r\n                return this.data.rows.length < this.data.total;\r\n              }\r\n      },\r\n      methods:{\r\n        async fetchData(){\r\n          return await msgApi.genMessage(this.page, this.limit);\r\n        },\r\n        handleScroll(dom){\r\n          //console.log(dom)\r\n          if(this.isLoading || !dom){\r\n            //可加载更多\r\n            return;\r\n          }\r\n          const range = 100;//定一个可接受的范围，在这个范围内都算达到了底部\r\n          const dec = Math.abs(dom.scrollTop + dom.clientHeight - dom.scrollHeight);\r\n          if(dec <= range){\r\n            this.fetchMore();\r\n          }\r\n        \r\n        },\r\n        //加载下一页\r\n        async fetchMore(){\r\n            if(!this.hasMose){\r\n              //没有更多了\r\n              return\r\n            }\r\n            this.isLoading = true;\r\n            this.page++;\r\n            const resp = await this.fetchData();\r\n            this.data.total = resp.total;\r\n            this.data.rows = this.data.rows.concat(resp.rows);\r\n            this.isLoading = false;\r\n        },\r\n        async handleSubmit(data, callback){\r\n          const resp = await msgApi.postMessage(data);\r\n              this.data.rows.unshift(resp);\r\n              callback(\"感谢您的留言\");\r\n        }\r\n      }\r\n}\r\n</script>\r\n\r\n<style >\r\n.message-container{\r\n  width: 100%;\r\n  height: 100%;\r\n  position: relative;\r\n  overflow-y: auto;\r\n  box-sizing: border-box;\r\n}\r\n.message-area-container{\r\n  width: 700px;\r\n  padding: 25px 0;\r\n  margin: 0 auto;\r\n}\r\n</style>"]}]}