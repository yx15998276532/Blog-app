{"remainingRequest":"E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\src\\views\\Message\\index.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\src\\views\\Message\\index.vue","mtime":1619069503738},{"path":"E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\VUE2学习\\搭建工程\\个人博客项目\\my-site\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKDQoubWVzc2FnZS1jb250YWluZXJ7DQogIHdpZHRoOiAxMDAlOw0KICBoZWlnaHQ6IDEwMCU7DQogIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgb3ZlcmZsb3cteTogYXV0bzsNCiAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCn0NCi5tZXNzYWdlLWFyZWEtY29udGFpbmVyew0KICB3aWR0aDogNzAwcHg7DQogIHBhZGRpbmc6IDI1cHggMDsNCiAgbWFyZ2luOiAwIGF1dG87DQp9DQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/Message","sourcesContent":["<template>\r\n<div class=\"message-container\" ref=\"messageContainer\">\r\n <MessageArea title=\"留言板\" :subTitle=\"`(${data.total})`\" \r\n :isListLoading=\"isLoading\" :list=\"data.rows\" @submit=\"handleSubmit\" />\r\n</div>\r\n \r\n</template>\r\n\r\n<script>\r\nimport MessageArea from \"@/components/MessageArea\";\r\nimport fetchData from \"@/mixins/fetchData.js\";\r\nimport * as msgApi from \"@/api/message.js\";\r\nimport mainScroll from \"@/mixins/mainScroll.js\";\r\n\r\nexport default {\r\n  mixins:[fetchData( {total: 0, rows: [] } ), mainScroll(\"messageContainer\")],\r\n      components:{\r\n        MessageArea,\r\n      },\r\n      data(){\r\n            return {\r\n              page:1 ,\r\n              limit: 10\r\n            }\r\n      },\r\n      created(){\r\n        this.$bus.$on(\"mainScroll\",this.handleScroll);\r\n      },\r\n      destroyed(){\r\n        this.$bus.$off(\"mainScroll\", this.handleScroll);\r\n      },\r\n      computed:{\r\n              hasMose(){\r\n                return this.data.rows.length < this.data.total;\r\n              }\r\n      },\r\n      methods:{\r\n        async fetchData(){\r\n          return await msgApi.genMessage(this.page, this.limit);\r\n        },\r\n        handleScroll(dom){\r\n          //console.log(dom)\r\n          if(this.isLoading || !dom){\r\n            //可加载更多\r\n            return;\r\n          }\r\n          const range = 100;//定一个可接受的范围，在这个范围内都算达到了底部\r\n          const dec = Math.abs(dom.scrollTop + dom.clientHeight - dom.scrollHeight);\r\n          if(dec <= range){\r\n            this.fetchMore();\r\n          }\r\n        \r\n        },\r\n        //加载下一页\r\n        async fetchMore(){\r\n            if(!this.hasMose){\r\n              //没有更多了\r\n              return\r\n            }\r\n            this.isLoading = true;\r\n            this.page++;\r\n            const resp = await this.fetchData();\r\n            this.data.total = resp.total;\r\n            this.data.rows = this.data.rows.concat(resp.rows);\r\n            this.isLoading = false;\r\n        },\r\n        async handleSubmit(data, callback){\r\n          const resp = await msgApi.postMessage(data);\r\n              this.data.rows.unshift(resp);\r\n              callback(\"感谢您的留言\");\r\n        }\r\n      }\r\n}\r\n</script>\r\n\r\n<style >\r\n.message-container{\r\n  width: 100%;\r\n  height: 100%;\r\n  position: relative;\r\n  overflow-y: auto;\r\n  box-sizing: border-box;\r\n}\r\n.message-area-container{\r\n  width: 700px;\r\n  padding: 25px 0;\r\n  margin: 0 auto;\r\n}\r\n</style>"]}]}